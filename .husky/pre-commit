# Check if there are any staged .ts, .tsx, or .js files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js)$' || true)

# Run lint-staged only if there are relevant files
if [ -n "$STAGED_FILES" ]; then
  echo "üîç Running ESLint on staged files..."
  
  # Run lint-staged and capture exit code immediately
  npx lint-staged
  LINT_EXIT_CODE=$?
  
  # If lint-staged fails, exit immediately
  if [ $LINT_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "‚ùå Linting failed. Please fix the errors and try again."
    echo "   Commit aborted."
    exit $LINT_EXIT_CODE
  fi
  
  echo "‚úÖ Linting passed!"
  
  # If lint-staged passes, prompt for version bump
  # Store the original package.json content to check if it changed
  ORIGINAL_HASH=$(git hash-object package.json 2>/dev/null || echo "")
  
  # Run version bump script
  node scripts/bump-version.js
  
  # Check if package.json was modified and stage it if so
  NEW_HASH=$(git hash-object package.json 2>/dev/null || echo "")
  if [ "$ORIGINAL_HASH" != "$NEW_HASH" ] && [ -n "$NEW_HASH" ]; then
    git add package.json
    echo "‚úì package.json staged with new version"
  fi
else
  echo "‚ÑπÔ∏è  No .ts, .tsx, or .js files staged, skipping lint-staged and version bump"
fi
